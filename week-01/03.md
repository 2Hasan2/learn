## **Day 3: Advanced Shell Scripting and Automation Techniques**

### **1. Advanced Scripting Techniques**

*Objective*: Introduce students to more advanced concepts in shell scripting to enhance their skills and productivity.

#### **Concepts to Cover**:
- **Array Variables**: Defining and using indexed and associative arrays.
- **String Manipulation**: String concatenation, substring extraction, and string replacement.
- **User-defined Functions**: Scope and parameter passing.
- **Error Handling**: Implementing traps for signals and errors.

#### **Example Tasks**:
1. Create an indexed array to store a list of fruits and a function to print the fruits in uppercase.
2. Write a function that takes two strings and checks if they are equal, ignoring case.

**Example Script**:
```bash
#!/bin/bash

# Indexed Array
fruits=("apple" "banana" "cherry")

# Function to print fruits in uppercase
print_fruits() {
  for fruit in "${fruits[@]}"; do
    echo "${fruit^^}"  # Convert to uppercase
  done
}

# Call the function
print_fruits

# Function to compare two strings
compare_strings() {
  if [[ "${1,,}" == "${2,,}" ]]; then
    echo "Strings are equal."
  else
    echo "Strings are not equal."
  fi
}

compare_strings "Hello" "hello"
```

---

### **2. Debugging Shell Scripts**

*Objective*: Teach students how to effectively debug shell scripts using various techniques.

#### **Techniques to Cover**:
- **Debugging Options**: Enable tracing with `set -x`.
- **Using `trap` for Error Handling**: Catching errors and executing cleanup tasks.
- **Conditional Debugging**: Conditional logging based on environment variables.

#### **Example Task**:
1. Write a script that demonstrates using `trap` to handle errors and clean up temporary files.

**Example Debugging Script**:
```bash
#!/bin/bash

# Cleanup function
cleanup() {
  echo "Cleaning up..."
  rm -f /tmp/tempfile
}

trap cleanup EXIT  # Call cleanup on exit

# Create a temporary file
touch /tmp/tempfile

# Simulate an error
echo "This is a test." > /tmp/tempfile || { echo "Failed to write to tempfile"; exit 1; }
```

---

### **3. Working with Command Line Arguments**

*Objective*: Introduce students to passing and handling command line arguments in scripts for more dynamic functionality.

#### **Concepts to Cover**:
- **Positional Parameters**: Accessing `$1`, `$2`, and using `shift` to manage arguments.
- **Using `getopts` for Parsing Options**: Implementing command-line options for better usability.

#### **Example Task**:
1. Write a script that accepts multiple filenames as arguments and concatenates their contents into a single output file.

**Example Script**:
```bash
#!/bin/bash

output_file="output.txt"
> "$output_file"  # Create or clear the output file

# Loop through all arguments
while [[ $# -gt 0 ]]; do
  if [[ -f "$1" ]]; then
    cat "$1" >> "$output_file"  # Append file content to output
  else
    echo "$1 is not a valid file." >&2  # Error message
  fi
  shift  # Move to the next argument
done

echo "Contents merged into $output_file"
```

---

### **4. File Processing with `awk` and `sed`**

*Objective*: Familiarize students with powerful text processing tools: `awk` and `sed` for data manipulation.

#### **Concepts to Cover**:
- **Using `awk`**: Field separators, built-in variables, and patterns for data extraction.
- **Using `sed`**: Performing complex replacements and text transformations.

#### **Example Tasks**:
1. Use `awk` to calculate the total and average of numbers in a CSV file.
2. Use `sed` to remove all blank lines and comments from a configuration file.

**Example `awk` Command**:
```bash
awk -F, '{sum += $2} END {print "Total:", sum; print "Average:", sum/NR}' data.csv
```

**Example `sed` Command**:
```bash
sed '/^\s*$/d; /^#/d' config.txt > cleaned_config.txt
```

---

### **5. Downloading Files with `wget` and `curl`**

*Objective*: Introduce students to `wget` and `curl` for downloading files and interacting with web services.

#### **Concepts to Cover**:
- **`wget`**:
  - Basic usage and options.
  - Recursive downloads, downloading entire websites.
  
- **`curl`**:
  - Making HTTP requests.
  - Sending and receiving data.
  - Authenticating with APIs.

#### **Using `wget`**:
- To download a single file:
  ```bash
  wget https://example.com/file.zip
  ```
- To download an entire website:
  ```bash
  wget --mirror --convert-links --adjust-extension --page-requisites --no-parent https://example.com/
  ```

#### **Using `curl`**:
- To make a simple GET request:
  ```bash
  curl https://api.example.com/data
  ```
- To send JSON data with a POST request:
  ```bash
  curl -X POST https://api.example.com/resource -H "Content-Type: application/json" -d '{"key":"value"}'
  ```

#### **Example Task**:
1. Write a script that uses `curl` to fetch data from a public API (e.g., JSONPlaceholder) and outputs specific fields.

**Example `curl` Script**:
```bash
#!/bin/bash

# Fetch data from a public API
response=$(curl -s https://jsonplaceholder.typicode.com/posts)

# Parse and output titles
echo "$response" | jq '.[].title'
```

---

### **6. Interacting with APIs**

*Objective*: Teach students how to interact with APIs using `curl`, focusing on authentication, requests, and response handling.

#### **Concepts to Cover**:
- **Understanding RESTful APIs**:
  - Methods: GET, POST, PUT, DELETE.
  - Status codes: 200, 404, 500, etc.
  
- **Authentication**:
  - Using API keys, tokens, and basic authentication.

#### **Example Task**:
1. Write a script that interacts with a weather API (like OpenWeatherMap) to fetch the current weather for a specified city.

**Example Weather Script**:
```bash
#!/bin/bash

API_KEY="your_api_key"
CITY="London"

# Fetch weather data
response=$(curl -s "https://api.openweathermap.org/data/2.5/weather?q=${CITY}&appid=${API_KEY}&units=metric")

# Parse and output temperature and weather description
temperature=$(echo "$response" | jq '.main.temp')
description=$(echo "$response" | jq -r '.weather[0].description')

echo "The current temperature in $CITY is $temperatureÂ°C with $description."
```

---

### **7. Creating and Using Cron Jobs for Automation**

*Objective*: Teach students how to schedule recurring tasks using `cron`.

#### **Concepts to Cover**:
- **Understanding Cron Syntax**: Breakdown of fields in crontab entries.
- **Creating Cron Jobs**: Use `crontab -e` to create a cron job for a backup script.

#### **Example Cron Job**:
```bash
0 2 * * * /path/to/backup_script.sh  # Runs daily at 2 AM
```

#### **Learning Task**:
1. Set up a cron job to run a system cleanup script every Sunday at midnight.

---

### **8. Homework Assignment**

1. Write a shell script that automates the process of archiving logs older than 30 days in a specified directory.
2. Create a cron job that runs the above script every day at midnight.
3. Implement a script that sends an email alert when disk usage exceeds a certain threshold using `df` and `mail` commands.
4. Write a script to interact with an API of your choice, retrieve some data, and format the output in a user-friendly way.

---
